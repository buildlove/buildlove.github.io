<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="用于个人笔记">
  <meta name="author" content="Screenshot 2015">
  <!-- Open Graph Data -->
  <meta property="og:title" content="centos上配置mongodb"/>
  <meta property="og:description" content="用于个人笔记" />
  <meta property="og:site_name" content="liyang&#39;s blog"/>
  <meta property="og:type" content="article" />
  <meta property="og:image" content="http://buildlove.github.ioundefined"/>
  
    <link rel="alternate" href="/atom.xml" title="liyang&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  

  <!-- Site Title -->
  <title>liyang's blog</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <!-- Custom CSS -->
  
  <link rel="stylesheet" href="/css/style.light.css">

  <!-- Google Analytics -->
  

</head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/img/default-banner-dark.jpg)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">centos上配置mongodb</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/">
                  
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="/archives">
                  
                  Archives
                  
                </a>
              </li>
            
              <li>
                <a href="https://github.com/buildlove">
                  
                  Github
                  
                </a>
              </li>
            
              <li>
                <a href="mailto:mkdir_yang@163.com">
                  
                  Email
                  
                </a>
              </li>
            
              <li>
                <a href="https://www.jianshu.com/u/c4bc363ac296">
                  
                  简书
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>

<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
            <!-- Author -->
            <span class="author info">By Screenshot 2015</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">2016-10-13</span>
            <span class="time">16:35:21</span>
          </span>
          
          <!--  Categories  -->
            <span class="categories info">Under 

<a href="/categories/database/">database</a>
</span>
          
        </div>
        <!-- Tags -->
        
          <div class="post-tags text-muted">
            Tags: 

<a class="tag" href="/tags/database/">#database</a> <a class="tag" href="/tags/mongodb/">#mongodb</a>


          </div>
        
        <!-- Post Main Content -->
        <div class="post-content">
          <p>mongodb 使用方式<br><a id="more"></a></p>
<p>主要目录文件所在位置<br>path: /usr/local/mongodb<br>mongod.lock: 根目录/data/db/mongod.lock<br>logpath=/usr/local/mongodb/logs/mongodb.log<br>/data/db: 根目录/data/db<br>配置文件：/usr/local/mongodb/bin/mongodb.conf</p>
<h2 id="下载安装包-解压-移动到-usr-local目录下并改名"><a href="#下载安装包-解压-移动到-usr-local目录下并改名" class="headerlink" title="下载安装包-解压-移动到/usr/local目录下并改名"></a>下载安装包-解压-移动到/usr/local目录下并改名</h2><p>wget <a href="https://fastdl.mongodb.org/linux/mongodb-linux-i686-3.0.2.tgz" target="_blank" rel="external">https://fastdl.mongodb.org/linux/mongodb-linux-i686-3.0.2.tgz</a><br>gzip -d mongodb-linux-i686-3.0.2.tgz<br>tar xvf mongodb-linux-i686-3.0.2.tar<br>mv mongodb-linux-i686-3.0.2 /usr/local/mongodb<br>cd /usr/local/mongodb<br>mkdir db<br>mkdir logs<br>cd bin<br>vi mongodb.conf</p>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>vi /usr/local/mongodb/mongodb.conf:dbpath=/usr/local/mongodb/db<br>写入以下配置项<br>dbpath=/data/db #指定数据库路径<br>logpath=/usr/local/mongodb/logs/mongodb.log #指定打印文件路径<br>port=27017  #端口<br>fork=true   #是否后台运行<br>nohttpinterface=true<br>auth=true   #是否验证账号密码</p>
<h2 id="开机自动启动mongodb"><a href="#开机自动启动mongodb" class="headerlink" title="开机自动启动mongodb"></a>开机自动启动mongodb</h2><p>vi /etc/rc.d/rc.local<br>/usr/local/mongodb/bin/mongod –config /usr/local/mongodb/bin/mongodb.conf</p>
<h2 id="重启一下系统测试下能不能自启"><a href="#重启一下系统测试下能不能自启" class="headerlink" title="重启一下系统测试下能不能自启"></a>重启一下系统测试下能不能自启</h2><p>进入mongodb的shell模式<br>/usr/local/mongodb/bin/mongod<br>查看数据库列表<br>show dbs<br>当前db版本<br>db.version();</p>
<h2 id="建立软链接"><a href="#建立软链接" class="headerlink" title="建立软链接"></a>建立软链接</h2><p>ln -s /usr/local/mongodb/bin/mongod /usr/bin<br>ln -s /usr/local/mongodb/bin/mongo /usr/bin</p>
<h2 id="后台启动或关闭"><a href="#后台启动或关闭" class="headerlink" title="后台启动或关闭"></a>后台启动或关闭</h2><p>启动（必须带着–logpath）<br>mongod –fork –logpath=/usr/local/mongodb/logs/mongodb.log<br>(如果报错child process failed -&gt;&gt; rm -rf /data/db/mongod.lock)</p>
<p>关闭后台<br>mongo<br>use admin<br>db.shutdownServer()</p>
<h2 id="远程连接mongodb"><a href="#远程连接mongodb" class="headerlink" title="远程连接mongodb"></a>远程连接mongodb</h2><p>mongo 127.0.0.1:27017/test -utest -ptest<br>没有用户名和密码验证的话，直接使用：<br>mongo 127.0.0.1:27017/test</p>
<h2 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h2><ol>
<li>数据库用户角色：read、readWrite;</li>
<li>数据库管理角色：dbAdmin、dbOwner、userAdmin；</li>
<li>集群管理角色：clusterAdmin、clusterManager、clusterMonitor、hostManager；</li>
<li>备份恢复角色：backup、restore；</li>
<li>所有数据库角色：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase</li>
<li>超级用户角色：root</li>
<li>间接或直接提供了系统超级用户的访问（dbOwner 、userAdmin、userAdminAnyDatabase）</li>
<li>内部角色：__system<br>Read：允许用户读取指定数据库<br>readWrite：允许用户读写指定数据库<br>dbAdmin：允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计或访问system.profile<br>userAdmin：允许用户向system.users集合写入，可以找指定数据库里创建、删除和管理用户<br>clusterAdmin：只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管理权限。<br>readAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的读权限<br>readWriteAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的读写权限<br>userAdminAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的userAdmin权限<br>dbAdminAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的dbAdmin权限。<br>root：只在admin数据库中可用。超级账号，超级权限</li>
</ol>
<h2 id="设置用户"><a href="#设置用户" class="headerlink" title="设置用户"></a>设置用户</h2><p>mongodb默认是不需要账号密码的，如果配置文件内有auth=true字段，设置以下账户将开启账号密码<br>mongodb内一个table一个账户，admin表里给予userAdmin可以管理所有用户<br>如果需要管理所有用户，必须use amdin &amp;&amp; db.auth(“superadmin”,”superadmin”)</p>
<p>use admin 切换到admin账户<br>创建超级管理员<br>mongodb 2.6以后的版本都是createUser之前是addUser<br>一般人不建议用直接使用root<br>db.createUser({<br>    user: “superadmin”,<br>    pwd: “superadmin”,<br>    roles: [<br>      { role: “root”, db: “admin” }<br>    ]<br>})<br>db.auth(“superadmin”, “superadmin”)验证超级管理员的存在(1代表存在0代表不存在)<br>use abc 使用abc数据库(注意：创建用户一定要到指定的表里面然后创建，创建管理员才在admin表里创建)<br>创建用户(用户拥有abc数据库的所有权限)<br>db.createUser({<br>    user: “abc”,<br>    pwd: “abc”,<br>    roles: [<br>      { role: “dbOwner”, db: “abc” }<br>    ]<br>})<br>创建用户之后需要输入账号密码才能登陆mongo<br>mongo -u root -p</p>
<h2 id="忘记密码"><a href="#忘记密码" class="headerlink" title="忘记密码"></a>忘记密码</h2><p>忘掉密码必须先去掉auth=true参数，然后清除admin表中的system.users,之后创建账号或者不创建<br>vi /usr/local/mongodb/bin/mongodb.conf<br>注释掉auth=true(这个参数配置意思是需要验证)<br>use admin<br>删除账号密码<br>db.system.users.remove({})<br>重新设置账号密码，重启mongodb</p>

        </div>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          Sharing and growing is important
        <p class="copyright text-muted">
          thanks for <a target="_blank" href="https://github.com/buildlove">myself</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->
<script src="/js/highlight.pack.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

